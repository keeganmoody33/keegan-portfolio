# Cursor Rules — Keegan Moody Portfolio

> For AI assistants working on this codebase
> Last updated: 2026-02-09

---

## Workflow: Documentation First, Code Second

This project follows a documentation-first methodology. Before writing code:

1. Read `CLAUDE.md` and `progress.txt` at session start
2. Review `lessons.md` for patterns and mistakes to avoid
3. Reference the six canonical docs for any implementation work
4. Update `progress.txt` after completing any feature
5. Update `lessons.md` after every correction

**The six canonical docs (in `portfolio-site/`):**

| Doc | Purpose |
|-----|---------|
| `PRD.md` | What we're building, who it's for, what's in scope |
| `APP_FLOW.md` | Every route, every interaction flow, every state |
| `TECH_STACK.md` | Locked dependencies, exact versions, external APIs |
| `FRONTEND_GUIDELINES.md` | Design tokens, component patterns, responsive rules |
| `BACKEND_STRUCTURE.md` | Database schema, API contracts, Edge Function specs |
| `IMPLEMENTATION_PLAN.md` | Phased build sequence with validation steps |

**Session files:**

| File | Purpose |
|------|---------|
| `CLAUDE.md` (repo root) | AI operating manual -- rules, context, constraints |
| `portfolio-site/progress.txt` | What's done, what's in progress, what's next |
| `portfolio-site/lessons.md` | Mistakes and patterns to avoid |

---

## Project Overview

This is Keegan Moody's portfolio website with AI-powered chat and JD analyzer features.

**Stack:**
- Frontend: Next.js (App Router) in `portfolio-site/`
- Backend: Supabase (PostgreSQL + Edge Functions)
- AI: Claude API via Edge Functions
- Analytics: PostHog (client + server)
- Deployment: Vercel (auto-deploy on push to main)
- Live URL: [lecturesfrom.com/keeganmoody33](https://lecturesfrom.com/keeganmoody33)

---

## Database Schema (Critical)

Full schema in `portfolio-site/BACKEND_STRUCTURE.md`. Quick reference for correct column names:

```sql
candidate_profile:
  id, first_name, last_name, email, location
  headline (NOT title)
  summary (NOT elevator_pitch, career_narrative, looking_for)
  linkedin_url, github_url, portfolio_url

experiences:
  id, candidate_id, company_name
  role_title (NOT title)
  start_date, end_date, duration_months
  public_bullets (ARRAY) — NOT bullet_points
  private_context_what_id_do_differently
  private_context_manager_would_say
  display_order

ai_instructions:
  id, candidate_id, created_at
  instruction_type, instruction, priority, content

skills:
  skill_name, category, evidence
```

**Common mistakes to avoid:**
- `profile.name` → Use `${profile.first_name} ${profile.last_name}`
- `profile.title` → Use `profile.headline`
- `exp.bullet_points` → Use `exp.public_bullets`
- Table is `candidate_profile` (singular), NOT `candidate_profiles` (plural)

---

## Edge Functions

Located in `supabase/functions/`:

| Function | Purpose | Endpoint |
|----------|---------|----------|
| `chat/index.ts` | Portfolio AI chat | `/functions/v1/chat` |
| `jd-analyzer/index.ts` | Job description fit analysis | `/functions/v1/jd-analyzer` |

**Deploy command:**
```bash
supabase functions deploy chat
supabase functions deploy jd-analyzer
```

---

## API Routes (Next.js Proxy Pattern)

All API routes follow: browser → Next.js Route Handler (keeps keys server-side) → external API.

| Route | Method | Proxies To |
|-------|--------|------------|
| `/api/chat` | POST | Supabase `chat` Edge Function |
| `/api/discogs` | GET | Discogs API |
| `/api/github` | GET | GitHub public events API |
| `/api/jd-analyzer` | POST | Supabase `jd-analyzer` Edge Function |

Full contracts in `portfolio-site/BACKEND_STRUCTURE.md`.

---

## AI Behavior Philosophy

The portfolio AI should:
- **Lead with value** — not confessions
- **Acknowledge gaps only when directly asked**
- **Ask questions back** to engage visitors
- **Frame growth constructively** — not self-sabotage

**Do NOT have the AI:**
- Volunteer firing history
- Use phrases like "I can't", "I'm not qualified", "drowned in autonomy"
- Lead with limitations

---

## Component Rules

- All components are `'use client'` and live in `portfolio-site/components/`
- Functional components with hooks (no class components)
- No inline styles -- always Tailwind classes or CSS custom properties
- PostHog tracking on every interactive component
- Style per `FRONTEND_GUIDELINES.md` design tokens

---

## Git Workflow

- **Main branch:** Production (Vercel auto-deploys)
- **Feature branches:** Use for multi-file changes or experiments
- **Naming:** `fix/description` or `feature/description`

---

## Testing Checklist

After changes to Edge Functions:

1. Deploy: `supabase functions deploy <function-name>`
2. Test chat: Ask "What are you looking for in your next role?"
3. Test edge case: Ask "Why have you had short stints?"
4. Test JD analyzer: Paste a real job posting URL

After changes to frontend:

1. Check desktop and mobile
2. Verify PostHog events fire
3. Test error states (disable network, bad input)
4. Test empty states

---

*Cursor rules v4.0 — Documentation first. Code second. Always.*
